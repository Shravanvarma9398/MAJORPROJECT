<% layout('layouts/boilerplate') %>
<style>
  /* Your existing styles here */

  .tax-info {
    display: none;
  }
  .tax-toggle {
    /* your styles */
  }
</style>

<div id="filters">
  <!-- filters as before -->

  <div class="tax-toggle">
    <div class="form-check-reverse form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault" />
      <label class="form-check-label" for="switchCheckDefault">Display total after taxes</label>
    </div>
  </div>
</div>

<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
  <% for(let listing of allListings) { %>
    <a href="/listings/<%=listing._id %>" class="listing-link">
      <div class="card col listing-card">
        <img src="<%= listing.image.url %>" class="card-img-top" alt="listing_imge" style="height: 20rem" />
        <div class="card-img-overlay"></div>
        <div class="card-body">
          <p class="card-text">
            <b><%= listing.title %></b><br>
            <span class="price-no-tax">&#8377; <%= listing.price.toLocaleString("en-IN") %></span>
            <span class="price-with-tax d-none">&#8377; <%= Math.round(listing.price * 1.18).toLocaleString("en-IN") %></span> / night
            <i class="tax-info"> &nbsp; +18% GST</i>
          </p>
        </div>
      </div>
    </a>
  <% } %>
</div>

<script>
  const taxSwitch = document.getElementById("switchCheckDefault");
  taxSwitch.addEventListener("change", () => {
    const noTaxPrices = document.querySelectorAll(".price-no-tax");
    const withTaxPrices = document.querySelectorAll(".price-with-tax");
    const taxInfoLabels = document.querySelectorAll(".tax-info");

    if (taxSwitch.checked) {
      noTaxPrices.forEach(el => el.classList.add("d-none"));
      withTaxPrices.forEach(el => el.classList.remove("d-none"));
      taxInfoLabels.forEach(el => el.style.display = "inline");
    } else {
      noTaxPrices.forEach(el => el.classList.remove("d-none"));
      withTaxPrices.forEach(el => el.classList.add("d-none"));
      taxInfoLabels.forEach(el => el.style.display = "none");
    }
  });
</script>
